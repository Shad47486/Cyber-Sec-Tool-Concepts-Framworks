# What is Aurora?

* Aurora is a Windows endpoint agent that uses Sigma rules and IOCs to detect threat patterns on local event streams using ETW.
  * [Review Sigma](/Logging/Tools/Sigma/sigma.md)
  * When a true-positive rule matches, Aurora triggers “response actions” that will be displayed under the Windows Event Log Viewer.
    * It has been designed to be customisable based on the Sigma rule set and function as an on-premises tool, with no data leaving the network.
  * Aurora is supported on Windows 7/ Windows Server 2012 or newer versions and must run using administrator privileges.
    * It must also be excluded from any running antivirus or EDR solutions.
    * This is to avoid the application being blocked from executing its services.
      * [How to install Aurora agent](<https://aurora-agent-manual.nextron-systems.com/en/latest/index.html>)
  * [Aurora Enterprise vs Aurora Lite](/examples/aure_vs_aurlite.png)

* Aurora obtains data from different ETW channels and adds live information (for the commercial version) to enrich and recreate events similar to those generated by Sysmon.
  * It does not create tons of logs; it only populates the viewer with events of triggered rules.
    * [Table comparing Aurora and Sysmon](/examples/aur_vs_sys.png)

* Aurora can be configured to use four different configuration formats that dictate how the solution would fetch events and raise alerts.
  * The 4 preset formats are:
    * Standard: This configuration covers events at a medium level of severity.
    * Reduced: This configuration looks at events considered to be at a high minimum reporting level.
    * Minimal: This configuration looks at events considered to be at a high minimum reporting level.
    * Intense: This configuration looks at events considered to be at a low minimum reporting level.
      * [Configuration table showing Deactivated sources, CPU limit, Process Priority, min reporting lvl, and Deactivated Modules](/examples/aurconfig_table.png)

## How to run Aurora?

* Aurora can be started directly via the CLI, with the option of selecting the preferred configuration.
  * aurora-agent.exe -c agent-config-minimal.yml

* For continuous running, the agent can also run as a service through the --install flag.
  * aurora-agent.exe --install -c agent-config-minimal.yml

* Useful Flags
  * Some valuable flags to use and query different types of information from Aurora include:
    * –status: Queries status information from the currently running service.
      * aurora-agent.exe --status
    * –trace: Queries all the events Aurora monitors from the subscribed channels.
      * It also provides complete event statistics.
        * aurora-agent.exe --trace > aurora-trace.log
    * –json: Outputs information in JSON format for a more comprehensive view of the alerts that are easy to search.

### What are Auroras output options?

* Windows Eventlog: Aurora writes its events using ETW; the details can be viewed via the EventViewer.
  * Click the “Details” tab in the output of an event to see all fields and values.

* Log File: A log file can be written using the --logfile flag, which will be automatically rotated once the specified log size has been attained (by default, this is 10MB).
  * The log files would be found under the directory where Aurora is running from.
  * CMD: aurora-agent.exe --logfile aurora-minimal.log
    * With this command, the Aurora status will include Stdout: enabled under its configuration Active Outputs section.
      * UDP/TCP Targets: Network targets direct Aurora events to an internal repository via UDP or TCP using the flags --udp-target and --tcp-target.
        * These options require arguments in the form of host: port, such as internal.repo:8443.

#### What are Aurora Responses?

* Responses extend the Sigma services and can be used to set specific actions to be performed and respond when an event matches.
  * These actions can help contain a threat actor or limit their damage to the system host.
  * The intended use cases for the responses are worm containment, ransomware containment, and the hard blocking of applications.

* Aurora supports two responses: Predefined and Custom.
  * Predefined Responses
    * The following responses are available by default with the installation of Aurora:
      * Suspend: Used to stop a specified process.
      * Kill: Used to kill a specified process.
      * Dump: Used to create a dump file found in the dump-path folder.
  * Custom Responses
    * Custom responses are meant to call an internal program to execute a function based on a raised alert.
    * The program has to be available from PATH and the answer would be a command-line query.
      * With these responses, a set of flags can be used to modify and relay different types of information.
    * The flags have been summarised in the table below:
      * Simulate - Used to test out rules, and responses that won't be triggered.
        * A log will be created to indicate the type of response that would be triggered.
      * Recursive - It is used to specify that the response will affect descendent processes.
        * It is usually true by default.
      * Low privilege only - Marked by the flag lowprivonly.
        * The flag specifies that the response will be triggered if the target process does not run as LOCAL SYSTEM or at an elevated role.
      * Ancestor - The ancestors flag specifies that the response will affect a process’s ancestor, not itself.
        * The key: value pair is indicated by integers to show the level of ancestors
          * EX: 1 is for parent process, 2 for grand-parent, 3 for great grandparent, and so on.
      * Process ID field - The processidfield flag specifies the field contains the process ID that shall be affected by the response.

##### Function Tests

* Once Aurora has been installed and configured, several function tests can be executed to check its various functionalities.
  * EX: Listing user account privileges: Running a simple command whoami /priv to list the current user privileges will trigger a Sigma rule with a level high and create a WARNING level message on the Eventlog.
    * This will be a process creation alert.
  * EX: Suspicious network communication: Running a suspicious DNS beaconing request will result in a critical rule being triggered.

##### Aurora Detection Gaps

* Since Aurora uses ETW to observe and monitor Windows system events, there are some sections where ETW events aren’t available or not easily usable.
  * These areas cover Aurora's detection gaps, and we shall look at them in this task.

* Named Pipes
  * Problem:
    * Named pipes are a one-way communication channel between processes that are subject to security checks in the memory.
    * ETW has no provider to gather information about the creation or connection to named pipes.
    * Observing named pipe events is through the Kernel Object Handle, which is noisy and can provide unnecessary information.
  * Solution to this:
    * Using Aurora under “Intense” configurations.
    * Complement Aurora configuration with Sysmon to capture the events.

* Registry Events
  * Problem:
    * Registry events are generated on the ETW by creating keys or writing values, primarily via the Microsoft-Windows-Kernel-Registry.
      * H/O, this information may not be directly usable as all registry handles must be tracked individually as keys are referenced by their handle.
    * Solution:
      * Using Aurora under “Intense” configurations.
      * Complement Aurora configuration with Sysmon to capture the events.

* ETW Disabled
  * Problem:
    * Attackers have the ability to disable ETW events by patching the system calls that Windows would use to create the events from user space.
    * Writing detection rules based on events that originate from the process and are caused by a provider that is not Microsoft-Windows-Kernel should be done with care.
  * Solution:
    * Aurora’s full version uses the ETW Canary module to detect any manipulations of ETW.
    * Using the flag --report-stats allows for reporting the agent’s status to your SIEM and will include stats of the observed, processed and dropped events that can indicate signs of manipulations.











